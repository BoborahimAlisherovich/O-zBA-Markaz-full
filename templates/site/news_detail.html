{% extends "site/base.html" %}

{% block title %}{{ news_item.title }} | O'zBA Malaka oshirish markazi{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50/30">
    <div class="bg-gradient-to-r from-slate-900 via-blue-900 to-slate-900 text-white py-6">
        <div class="container mx-auto px-4">
            <a href="{% url 'home' %}" class="text-blue-300 hover:text-white">Orqaga</a>
        </div>
    </div>

    <div class="container mx-auto px-4 py-12">
        <div class="max-w-5xl mx-auto">
            <article class="bg-white rounded-[3rem] shadow-2xl shadow-slate-200/50 overflow-hidden border border-slate-100">
                {% if news_images %}
                    <div class="relative h-[350px] md:h-[500px] overflow-hidden bg-slate-900">
                        {% for image in news_images %}
                            <img src="{{ image.image.url }}" alt="{{ news_item.title }}" class="news-slide absolute inset-0 w-full h-full object-cover {% if not forloop.first %}hidden{% endif %}">
                        {% endfor %}
                        {% if news_images|length > 1 %}
                            <button id="news-prev" class="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/20 rounded-full text-white">&lsaquo;</button>
                            <button id="news-next" class="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/20 rounded-full text-white">&rsaquo;</button>
                        {% endif %}
                    </div>
                {% endif %}

                <div class="p-8 md:p-12 space-y-6">
                    <p class="text-sm text-slate-500">{{ news_item.created_at|date:"d.m.Y" }}</p>
                    <h1 class="text-3xl md:text-4xl font-black text-slate-900 leading-tight">{{ news_item.title }}</h1>
                    <div class="h-1 w-20 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full"></div>
                    <div class="prose prose-lg max-w-none text-slate-600 leading-relaxed whitespace-pre-line">{{ news_item.content }}</div>
                </div>
            </article>

            {% if related_news %}
                <section class="mt-16">
                    <h2 class="text-2xl font-black text-slate-900 mb-8">Boshqa yangiliklar</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {% for item in related_news %}
                            <a href="{% url 'news_detail' item.id %}" class="group bg-white rounded-2xl overflow-hidden shadow-lg border border-slate-100 hover:-translate-y-1 transition-all">
                                <div class="h-40 overflow-hidden bg-slate-100">
                                    {% with first=item.images.first %}
                                        {% if first %}
                                            <img src="{{ first.image.url }}" alt="{{ item.title }}" class="w-full h-full object-cover">
                                        {% endif %}
                                    {% endwith %}
                                </div>
                                <div class="p-5">
                                    <span class="text-xs text-slate-400">{{ item.created_at|date:"d.m.Y" }}</span>
                                    <h3 class="text-sm font-bold text-slate-800 mt-1">{{ item.title }}</h3>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                </section>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function () {
    const slides = document.querySelectorAll('.news-slide');
    const prev = document.getElementById('news-prev');
    const next = document.getElementById('news-next');
    if (!slides.length || !prev || !next) return;
    let index = 0;

    function render() {
        slides.forEach(function (slide, idx) {
            if (idx === index) slide.classList.remove('hidden');
            else slide.classList.add('hidden');
        });
    }

    prev.addEventListener('click', function () {
        index = (index - 1 + slides.length) % slides.length;
        render();
    });

    next.addEventListener('click', function () {
        index = (index + 1) % slides.length;
        render();
    });
})();
</script>
{% endblock %}
